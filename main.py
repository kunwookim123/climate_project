import streamlit as st
import folium
from streamlit_folium import st_folium
import pandas as pd

# ------------------------------
# ì˜ˆì‹œ ë°ì´í„° (ì—°/ì›”/ì¼ + ìœ„ì¹˜ + ë°œì „ëŸ‰)
# ------------------------------
data = [
    [2020, 1, 10, "ì„œìš¸", 37.5665, 126.9780, 3.2],
    [2020, 2, 15, "ì„œìš¸", 37.5665, 126.9780, 3.6],
    [2021, 3, 5,  "ì„œìš¸", 37.5665, 126.9780, 3.8],
    [2021, 3, 20, "ì„œìš¸", 37.5665, 126.9780, 3.5],
    [2022, 6, 12, "ì„œìš¸", 37.5665, 126.9780, 4.0],
    [2023, 7, 9,  "ì„œìš¸", 37.5665, 126.9780, 3.3],
    [2024, 8, 21, "ì„œìš¸", 37.5665, 126.9780, 3.9],
    [2025, 9, 5,  "ì„œìš¸", 37.5665, 126.9780, 4.2],
]
df = pd.DataFrame(data, columns=["ì—°ë„", "ì›”", "ì¼", "ì§€ì—­", "ìœ„ë„", "ê²½ë„", "ë°œì „ëŸ‰"])

# ------------------------------
# ğŸ›ï¸ UI - ë‚ ì§œ ì„ íƒ
# ------------------------------
st.title("â˜€ï¸ íƒœì–‘ê´‘ ë°œì „ëŸ‰ ì§€ë„ (ë‚ ì§œë³„ ì„ íƒ)")

# âœ… ì—°ë„ 2020~2025 ê³ ì •
year = st.selectbox("ì—°ë„ ì„ íƒ", list(range(2020, 2026)), index=0)

# âœ… ì›” 1~12 ê³ ì •
month = st.selectbox("ì›” ì„ íƒ", list(range(1, 13)), index=0)

# âœ… ì¼ 1~31 ê³ ì •
day = st.selectbox("ì¼ ì„ íƒ", list(range(1, 32)), index=0)

# ------------------------------
# ğŸ“… ì„ íƒëœ ë‚ ì§œ ë°ì´í„° í•„í„°ë§
# ------------------------------
filtered = df[
    (df["ì—°ë„"] == year)
    & (df["ì›”"] == month)
    & (df["ì¼"] == day)
]

# ------------------------------
# ğŸ—ºï¸ ì§€ë„ ìƒì„±
# ------------------------------
m = folium.Map(location=[36.5, 127.8], zoom_start=7)

if not filtered.empty:
    for _, row in filtered.iterrows():
        folium.CircleMarker(
            location=[row["ìœ„ë„"], row["ê²½ë„"]],
            radius=row["ë°œì „ëŸ‰"] * 3,
            color="orange",
            fill=True,
            fill_opacity=0.6,
            popup=(
                f"<b>{row['ì§€ì—­']}</b><br>"
                f"{row['ì—°ë„']}ë…„ {row['ì›”']}ì›” {row['ì¼']}ì¼<br>"
                f"ğŸ”† ë°œì „ëŸ‰: {row['ë°œì „ëŸ‰']} kWh"
            ),
        ).add_to(m)
else:
    folium.Marker(
        [36.5, 127.8],
        popup=f"{year}ë…„ {month}ì›” {day}ì¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.",
        icon=folium.Icon(color="gray")
    ).add_to(m)

# ------------------------------
# ì§€ë„ ì¶œë ¥
# ------------------------------
st_folium(m, width=800, height=600)
